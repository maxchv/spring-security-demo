DROP TABLE APPOINTMENT IF EXISTS;
DROP TABLE AUTO_USER IF EXISTS;
DROP TABLE SERVICES IF EXISTS;
drop TABLE users IF EXISTS ;
drop TABLE authorities IF EXISTS ;

CREATE TABLE users (
  username VARCHAR_IGNORECASE(50) NOT NULL PRIMARY KEY,
  password VARCHAR_IGNORECASE(50) NOT NULL,
  enabled  BOOLEAN                NOT NULL
);

CREATE TABLE authorities (
  username  VARCHAR_IGNORECASE(50) NOT NULL,
  authority VARCHAR_IGNORECASE(50) NOT NULL,
  CONSTRAINT fk_authorities_users FOREIGN KEY (username) REFERENCES users (username)
);

CREATE UNIQUE INDEX ix_auth_username
  ON authorities (username, authority);

INSERT INTO users(username, password, enabled) VALUES ('max', '{noop}pass', TRUE );
INSERT INTO authorities(username, authority) VALUES ('max', 'ROLE_ADMIN');
INSERT INTO authorities(username, authority) VALUES ('max', 'ROLE_USER');

CREATE TABLE APPOINTMENT (
  APPOINTMENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
  APPOINTMENT_DT TIMESTAMP,
  MAKE           VARCHAR(255),
  MODEL          VARCHAR(255),
  YEAR           SMALLINT,
  USER_ID        BIGINT,
  STATUS         VARCHAR(255),
  PRIMARY KEY (APPOINTMENT_ID)
);

CREATE TABLE AUTO_USER (
  autoUserId BIGINT GENERATED BY DEFAULT AS IDENTITY,
  EMAIL      VARCHAR(255),
  FIRST_NAME VARCHAR(255),
  LAST_NAME  VARCHAR(255),
  PASSWORD   VARCHAR(255),
  USERNAME   VARCHAR(255),
  ROLE       VARCHAR(255),
  PRIMARY KEY (autoUserId)
);

CREATE TABLE SERVICES (
  APPOINTMENT_ID BIGINT NOT NULL,
  NAME           VARCHAR(255)
);

ALTER TABLE APPOINTMENT
  ADD CONSTRAINT FK_hjr0wl1nbp09iulymmarqjj08
FOREIGN KEY (USER_ID)
REFERENCES AUTO_USER;

ALTER TABLE SERVICES
  ADD CONSTRAINT FK_e1e9lupq7o7mwsgtbkwd6uivn
FOREIGN KEY (APPOINTMENT_ID)
REFERENCES APPOINTMENT;


INSERT INTO AUTO_USER (autoUserId, EMAIL, FIRST_NAME, LAST_NAME, PASSWORD, USERNAME, ROLE)
VALUES (NULL, 'kevin.m.bowersox@gmail.com', 'Kevin', 'Bowersox', 'password', 'kbowersox', 'ROLE_ADMIN');
INSERT INTO AUTO_USER (autoUserId, EMAIL, FIRST_NAME, LAST_NAME, PASSWORD, USERNAME, ROLE)
VALUES (NULL, 'johndoe@gmail.com', 'John', 'Doe', 'password', 'jodoe', 'ROLE_USER');
INSERT INTO AUTO_USER (autoUserId, EMAIL, FIRST_NAME, LAST_NAME, PASSWORD, USERNAME, ROLE)
VALUES (NULL, 'janedoe@gmail.com', 'Jane', 'Doe', 'password', 'jadoe', 'ROLE_USER');
INSERT INTO AUTO_USER (autoUserId, EMAIL, FIRST_NAME, LAST_NAME, PASSWORD, USERNAME, ROLE)
VALUES (NULL, 'juniordoe@gmail.com', 'Junior', 'Doe', 'password', 'jrdoe', 'ROLE_USER');

INSERT INTO APPOINTMENT (APPOINTMENT_ID, APPOINTMENT_DT, MAKE, MODEL, YEAR, USER_ID, STATUS)
VALUES (1, '2015-08-12 00:00:00', 'Subaru', 'Impreza', '2015', 1, 'Initial');
INSERT INTO APPOINTMENT (APPOINTMENT_ID, APPOINTMENT_DT, MAKE, MODEL, YEAR, USER_ID, STATUS)
VALUES (2, '2015-08-12 00:00:00', 'Subaru', 'Legacy', '2015', 2, 'Initial');

INSERT INTO SERVICES (APPOINTMENT_ID, NAME) VALUES (1, 'Oil Change');
INSERT INTO SERVICES (APPOINTMENT_ID, NAME) VALUES (1, 'Tire Change');
INSERT INTO SERVICES (APPOINTMENT_ID, NAME) VALUES (2, 'Antifreeze Change');
INSERT INTO SERVICES (APPOINTMENT_ID, NAME) VALUES (2, 'Bulb Change');

;